<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Code Quality and Style</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <script src="libs/xaringanExtra-progressBar/progress-bar.js"></script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <meta name="description" content="A overview how to put R code into production."/>
    <meta name="generator" content="xaringan and remark.js"/>
    <meta name="github-repo" content="edgar-treischl/Workshop_GitHubIntro"/>
    <meta name="twitter:title" content="Make it reproducibleR: Put R in Production"/>
    <meta name="twitter:description" content="A overview how to put R code into production."/>
    <meta name="twitter:url" content="https://edgar-treischl.github.io/Workshop_reproducibleR/"/>
    <meta name="twitter:card" content="summary"/>
    <meta property="og:title" content="Make it reproducibleR: Put R in Production"/>
    <meta property="og:description" content="A overview how to put R code into production."/>
    <meta property="og:url" content="https://edgar-treischl.github.io/Workshop_reproducibleR/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:locale" content="en_US"/>
    <meta property="article:author" content="Edgar J. Treischl"/>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="styles.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">


class: center, middle, title-slide









<style>.xe__progress-bar__container {
  top:0;
  opacity: 1;
  position:absolute;
  right:0;
  left: 0;
}
.xe__progress-bar {
  height: 0.25em;
  background-color: #023047;
  width: calc(var(--slide-current) / var(--slide-total) * 100%);
}
.remark-visible .xe__progress-bar {
  animation: xe__progress-bar__wipe 200ms forwards;
  animation-timing-function: cubic-bezier(.86,0,.07,1);
}
@keyframes xe__progress-bar__wipe {
  0% { width: calc(var(--slide-previous) / var(--slide-total) * 100%); }
  100% { width: calc(var(--slide-current) / var(--slide-total) * 100%); }
}</style>







&lt;a href="https://github.com/edgar-treischl/slidesCode" class="github-corner" aria-label="View source on GitHub"&gt;&lt;svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"&gt;&lt;path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/&gt;&lt;path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/&gt;&lt;path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/&gt;&lt;/svg&gt;&lt;/a&gt;&lt;style&gt;.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}&lt;/style&gt;

# Code Quality and Style

### &lt;a href="http://www.edgar-treischl.de" target="_blank"&gt;Dr. Edgar J. Treischl&lt;/a&gt;

.white[Last update: 2025-11-08]

.footnote.slide-footer[
  Press ‚≠ï or ‚û°Ô∏è to navigate
]





&lt;style type="text/css"&gt;
.reduced_opacity {
  opacity: 0.5;
}
&lt;/style&gt;





---
## Agenda



### 01 Bad Habits ü¶π‚Äç‚ôÄÔ∏è 
### 02 Coding conventions üöß
### 03 Develop with style and grace üòé





---

class: middle, center, inverse

## Let's face the truth, develop code but ...




---
background-image: url("images/beaker2.gif")
background-size: cover
class: bottom, center


# .white[Get rid of bad habits first &lt;br&gt; üòÑ] 

&lt;div class="remark-footer"&gt;&lt;a href="https://giphy.com/gifs/moodman-batman-smack-smacked-Qumf2QovTD4QxHPjy5" target="_blank" style="color: white;"&gt;Images source: MOODMAN&lt;/a&gt;&lt;/div&gt;




---
## Wipe the Slate Clean: Restart R Like a Pro

- Ever had code that worked perfectly on your machine ‚Äî but mysteriously breaks when someone else tries to run it?

- Old objects in your global environment, packages from another project, or global options you tweaked and forgot about ‚Äî they all linger like ghosts. 




``` r
# Leftover objects
important_setting &lt;- "production"

# Previously loaded function from packages
library(mypackage)

# Changed global options
options(stringsAsFactors = TRUE)  # Please don't do this in 2025
```

Your code may unknowingly rely on these leftovers. It runs perfectly on your machine ‚Äî but fails for anyone else who doesn‚Äôt share your local setup. 




---
## Wipe the Slate Clean: Restart R Like a Pro

.pull-left[

- üîÅ Restart your R session, run your code from scratch (Ctrl + Shift + F10) and make it a habit

- Do not save the workspace and do not load the workspace from an `.Rdata` file (Based on Bryan et al. 2021). 

- It‚Äôs the only way to ensure your script actually works in a fresh, clean R session 

 
#### The rm approach üî´

- `rm(list = ls())` deletes user-created objects from the global workspace.

- **But**: The script may break due to hidden dependencies on things you ran in this R process before you executed: Attached packages are not detached, changed options are not restored, working directory is untouched!





]

.pull-right[
&lt;figure&gt;
    &lt;img src="https://rstats.wtf/img/rstudio-workspace.png" style="width: 100%"/&gt;
&lt;/figure&gt;
]


---
background-image: url(https://github.com/rstudio/hex-stickers/blob/main/PNG/knitr.png?raw=true)
background-position: 90% 5%
background-size: 8%

## R vs. Rmd

### ü´∞ Code lives in R, Code and Text in Rmd files

If you need to create a document from a source code, run:


``` r
#spin converts an R script to an Rmd file
knitr::spin("script.R")
```

- Roxygen comments will be treated as text (more about that later)
- Add yaml header to the script to control the output


If you need to extract the code from an Rmd file, run:



``` r
#Extracts R code chunks from Rmd files
knitr::purl()
```

- Adjust the level of extraction with the `documentation` parameter (e.g., code only)
- Set `purl = FALSE` to avoid the extraction of code chunks (see Xie 2024)


---
background-image: url("images/beaker1.gif")
background-size: cover
class: bottom, center

## .orange[Get rid of messy code üòú] 





---
## 01: Write Clean Code

### Clean code prioritizes:

- Readability
- Simplicity
- Clarity

### Messy code often reveals itself through several common signs: 

- Long, complicated functions that try to do too much
- Duplicated code scattered throughout scripts
- Inconsistent naming that leaves you guessing what‚Äôs going on
- Absolute paths
- Hardcoded values


---

## Don't Go Places Where You Don't Belong ...

&lt;img src="images/drake.png" style="width: 65%"/&gt;


---

## 01: Abandon absolute paths, they will break anyway



``` r
# Don't:
readr::read_csv("~/Documents/Berichte/orig/104_data.csv")
```

```
## Error: '~/Documents/Berichte/orig/104_data.csv' does not exist.
```

### ‚ö° Ceate a project and use the `here` package:


``` r
# Here returns the path to the project
here::here()
```

```
## [1] "/Users/edgar/Develop/slides/slidesCode"
```



``` r
# Create a path to the file
here::here("data", "descriptive_title.csv")
```

```
## [1] "/Users/edgar/Develop/slides/slidesCode/data/descriptive_title.csv"
```












---

## Avoid Hardcoding Values or I‚Äôll Burn Your Code

.pull-left[

&lt;div class="info-box"&gt;
  &lt;i&gt;ü¶ú&lt;/i&gt; The pain begins if you forget to integrate those values as function parameters and later on your code becomes a mess to maintain.
&lt;/div&gt;



``` r
library(dplyr)
filtered_data &lt;- mtcars |&gt; filter(mpg &gt; 25)
```

]

.pull-right[

&lt;div class="info-box"&gt;
  &lt;i&gt;ü¶ú&lt;/i&gt; What if you want to filter by a different age? You‚Äôd have to search through your code to find every instance of 30 and change it ‚Äî and probably forget values.
&lt;/div&gt;






``` r
# Hardcoded rounding is not bad, true?
mtcars |&gt; mutate(mpg_rounded = round(mpg, 2))
```

]







---

## AHV or I‚Äôll Burn Your Code II


### Set parameters at the top of your file while developing ...


``` r
round_digits &lt;- 2
mpg_threshold &lt;- 25

mtcars |&gt;
  filter(mpg &gt; mpg_threshold) |&gt;
  mutate(mpg_rounded = round(mpg, round_digits))
```

```
##                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb mpg_rounded
## Fiat 128       32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1        32.4
## Honda Civic    30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2        30.4
## Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1        33.9
## Fiat X1-9      27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1        27.3
## Porsche 914-2  26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2        26.0
## Lotus Europa   30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2        30.4
```


- Once you start wrapping code into functions, pass those values as arguments ‚Äî even if you don‚Äôt plan to change them right now. You‚Äôre future-proofing your code.


---

## AHV or I‚Äôll Burn Your Code III

### Move it into a function with a default:


``` r
filter_and_round &lt;- function(data, mpg_limit, digits = 2) {
  data |&gt;
    dplyr::filter(mpg &gt; mpg_limit) |&gt;
    dplyr::mutate(mpg_rounded = round(mpg, digits))
}

# Use the default
filter_and_round(mtcars, mpg_limit = 25)
```

```
##                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb mpg_rounded
## Fiat 128       32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1        32.4
## Honda Civic    30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2        30.4
## Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1        33.9
## Fiat X1-9      27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1        27.3
## Porsche 914-2  26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2        26.0
## Lotus Europa   30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2        30.4
```

=&gt; This approach makes your code flexible, readable, and much easier to maintain. 

---
background-image: url("images/cookimonster.gif")
background-size: cover
class: bottom, center

## .white[Break into nice bites üòú] 

---
# Modular Code

### üëâ Each function should do one thing ‚Äî and do it well

- Modularity means breaking your code into smaller, self-contained pieces‚Äîtypically functions ‚Äî where each one handles a specific task
- Instead of writing one long script that tries to do everything, modular code splits the work into clear, manageable chunks


### üëâ This makes your code easier to read, test, and develop

- Each piece can be understood and worked on independently
- Reusable functions save time and reduce duplication
- Testing is simpler because you can write small, focused tests instead of validating everything at once
- And when changes are needed, they‚Äôre easier to make since you only need to update one part of the codebase


---

# Don‚Äôt Dump Everything in One Function

.pull-left[

- It‚Äôs tempting to just get everything working in a single function or a long R script ‚Äî a pipeline that loads the data, cleans it, analyzes it, and spits out a plot or, more generally, the result.

- As soon as you need to tweak something, explain it to someone else, or reuse part of it, things get messy. Suddenly, you‚Äôre stuck picking apart a script that‚Äôs hard to read, hard to change, and the code may break.

]

.pull-right[


``` r
# Load data
df &lt;- read.csv("data.csv")

# Data cleaning
df &lt;- df |&gt; 
  filter(!is.na(price)) |&gt; 
  mutate(price_log = log(price)) |&gt; 
  do_furher_fancy_things

# Analysis
model &lt;- lm(price_log ~ bedrooms + sqft, data = df)

# Plotting
plot(df$sqft, df$price_log)
```


]

### Keep it simple, stupid! Don't violated the KISS üëÑ principle


---

# Don‚Äôt Dump Everything in One Function


&lt;div class="info-box"&gt;
  &lt;i&gt;ü¶ú&lt;/i&gt; At first glance, it might seem fine ‚Äî but now imagine you want to reuse the cleaning logic in a different script. Or test how the model works on another dataset. Or change the plotting code without rerunning the model. You‚Äôre stuck. Everything depends on everything else.
&lt;/div&gt;

&gt; Your next step is code modularization which means breaking your logic into small, focused functions that each do one thing. That‚Äôs called separation of concerns, and it‚Äôs what keeps your code from turning into a tangled mess of confusion. Do yourself a huge favour: break your code into logical, reusable pieces.

- Separate at least logically, for example, put function that belong to data preparation, analysis, and reporting into different functions.
- If you want to organize your codebase, create separate R scripts (e.g., analyze.R, plot.R) that follow your internal logic ‚Äî and define functions for each logical, reusable step.



---

# Don‚Äôt Dump Everything in One Function

Break it down into smaller functions:

```r
# source.R
load_data &lt;- function(path) {
  read.csv(path)
}

clean_data &lt;- function(df) {
  df |&gt; filter(!is.na(price)) |&gt; mutate(price_log = log(price))
  ...
}

#&gt; And so on ...
```


#### ‚ö° This approach still violates the single responsibility principle, but it‚Äôs a start!


---

# Don‚Äôt Dump Everything in One Function

=&gt; If the last code is saved in a file called `source.R`, you can source it and call the functions as needed.


``` r
# Source the functions
source("source.R")

# Main script
df &lt;- load_data("data.csv")
df_clean &lt;- clean_data(df)
model &lt;- fit_model(df_clean)
plot_relationship(df_clean)
```


&lt;div class="info-box"&gt;
  &lt;i&gt;ü¶ú&lt;/i&gt; This version is better because it's modular, readable, and flexible. Want to swap in a new dataset? Easy. Want to test the clean_data function? Just do it, you are on fire.
&lt;/div&gt;




---

# Don‚Äôt Dump Everything in One Function


If the code need to run in sequence, wrap them in a function that makes the workflow explicit.


``` r
# Wrap the workflow in a function
run_job &lt;- function(data_path) {
  df &lt;- load_data(data_path)
  df_clean &lt;- clean_data(df)
  model &lt;- fit_model(df_clean)
  send_mail(result = model)
  result &lt;- plot_relationship(df_clean)
  
  return(result)
}
```

- It helps others understand how your code fits together

- Only after we break our code into logical, reusable pieces, we can really get to understand how to refactor it. Of course, it is extra work, but it‚Äôs part of the development process.


---
# Don‚Äôt Repeat Yourself (DRY)


### üëâ Wrap It in a Function

.pull-left[

&lt;div class="info-box"&gt;
  &lt;i&gt;ü¶ú&lt;/i&gt; Repeating the same code multiple times increases the risk of errors, bloats scripts, and makes maintenance harder. The DRY principle encourages you to write logic once and reuse it via functions. This makes your code cleaner, easier to test, and more maintainable.
&lt;/div&gt;



]

.pull-right[


``` r
library(gapminder)
library(dplyr)

# Filter for Germany in 2007
germany_2007 &lt;- gapminder |&gt;
  filter(country == "Germany", year == 2007) |&gt;
  select(country, year, lifeExp, gdpPercap)

# Filter for Japan in 2007
japan_2007 &lt;- gapminder |&gt;
  filter(country == "Japan", year == 2007) |&gt;
  select(country, year, lifeExp, gdpPercap)

# Filter for France in 2007
# And so on ...
```


]






---
# Don‚Äôt Repeat Yourself II

- Turn repeated code into parameterized functions to save time and avoid bugs.


``` r
slice_gapminder &lt;- function(data, country, year) {
  data |&gt;
    dplyr::filter(country == !!country, year == !!year) |&gt;
    dplyr::select(country, year, lifeExp, gdpPercap)
}
```

Now it's clean and reusable:


``` r
japan_2007 &lt;- slice_gapminder(gapminder, "Japan", 2007)
japan_2007
```

```
## # A tibble: 1 √ó 4
##   country  year lifeExp gdpPercap
##   &lt;fct&gt;   &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;
## 1 Japan    2007    82.6    31656.
```

Creating a function does not imply that we are ready yet.

---
# Don‚Äôt Repeat Yourself III

There is another very common blind spot when we apply functions:


``` r
# Coding is hard work
japan_2002 &lt;- slice_gapminder(gapminder, "Japan", 2002)
germany_2002 &lt;- slice_gapminder(gapminder, "Germany", 2002)
france_2002 &lt;- slice_gapminder(gapminder, "France", 2002)
```

üëâ Functions itself do not solve the problem of repetition if we call them repeatedly with only slight variations. 


---
# Base R against DRY


``` r
# Define inputs
countries &lt;- c("Japan", "Germany", "France")
years &lt;- rep(2002, length(countries))

# Apply the function to both vectors using mapply()
results_list &lt;- mapply(function(country, year) {
  slice_gapminder(gapminder, country, year)
}, countries, years, SIMPLIFY = FALSE)

# Combine the list of data frames into one
results &lt;- do.call(rbind, results_list)
results
```

```
## # A tibble: 3 √ó 4
##   country  year lifeExp gdpPercap
## * &lt;fct&gt;   &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;
## 1 Japan    2002    82      28605.
## 2 Germany  2002    78.7    30036.
## 3 France   2002    79.6    28926.
```




---
## Say Hello to *Purrr*

.pull-left[

&lt;div class="info-box"&gt;
  &lt;i&gt;ü¶ú&lt;/i&gt; The purrr package helps you avoid such repetitive code (Wickham and Henry 2025). The package is part of the tidyverse and provides a consistent, readable way to perform iteration in R. Instead of writing loops or repeating function calls manually, purrr lets you apply functions over lists, vectors, or data frames using a family of tools like map(), map2(), and pmap.
&lt;/div&gt;


]

.pull-right[
&lt;figure&gt;
    &lt;a href="https://purrr.tidyverse.org" target="_blank"&gt;&lt;img src="https://purrr.tidyverse.org/logo.png" alt="purrr.tidyverse.org" width="55%" align="center"/&gt;
&lt;/figure&gt;
]





---
background-image: url(https://purrr.tidyverse.org/logo.png)
background-position: 90% 5%
background-size: 8%

## Purrr against DRY



``` r
# Use purrr to iterate over countries and years
library(purrr)

# Extract the data for multiple countries and a specific year
countries &lt;- c("Japan", "Germany", "France")
years &lt;- rep(2002, length(countries))

# Map2 to apply the function across both vectors
results &lt;- map2(countries, years, ~ slice_gapminder(gapminder, .x, .y))

# Map2 returns a list, so we can bind the results
results |&gt; dplyr::bind_rows()
```

```
## # A tibble: 3 √ó 4
##   country  year lifeExp gdpPercap
##   &lt;fct&gt;   &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;
## 1 Japan    2002    82      28605.
## 2 Germany  2002    78.7    30036.
## 3 France   2002    79.6    28926.
```


---
background-image: url(https://purrr.tidyverse.org/logo.png)
background-position: 90% 5%
background-size: 8%

## Purrr against DRY

- As outlined, you don‚Äôt need purrr to avoid repetition ‚Äì you can achieve similar results using base R functions like `sapply()` and other *apply* variants. 

- This can be useful if you want to reduce dependencies or keep your code lightweight.

- However, purrr offers a more consistent and readable syntax, especially when working within the tidyverse ecosystem. Its functions are designed to work seamlessly with tibbles and dplyr verbs, making it easier to integrate into data analysis workflows.

- Purrr has further goodies like:
  - Progress bars
  - Parallel computing
  
### üëâ Purrr your way and DRY!


---
background-image: url("images/beaker3.gif")
background-size: cover
class: bottom, center

# .white[Robust Code don't bite ... üëª] 


---
# Robust Code

- A robust function behaves consistently: given the same input, it always returns the same output. This reliability starts with clearly defined inputs and outputs. 

A function should receive all the data it needs through its arguments‚Äîand return its results explicitly. 

- It should not rely on global variables or hidden dependencies. 

-  when each function is a self-contained unit, it‚Äôs easier to reuse and combine across your analysis or pipeline. 

- how to write functions that handle errors gracefully

- avoid unintended side effects (like accidental data exports)

- manage credentials securely


---
background-image: url(https://rlang.r-lib.org/logo.png)
background-position: 90% 5%
background-size: 8%

# Handle Errors Gracefully

.pull-left[

Write code that anticipates problems and handles them in a way that doesn‚Äôt crash your script or leave the user guessing (defensive programming)

- **Validating inputs**: check that function arguments meet expected criteria (e.g., correct type, range, format) before proceeding.

- **Catching errors**: use tryCatch() to manage potential errors during execution.

- **Helpful feedback**: when something goes wrong, provide clear, actionable error messages that guide the user on how to fix the issue.


]

.pull-right[

#### Check required input: `rlang::check_required(name)`


``` r
# This function requires a name argument
say_hello &lt;- function(name) {
  rlang::check_required(name)
  
  # Do a lot of steps before we greet
  # Let user wait ;)
  
  return(paste("Hello", name, "!"))
}

say_hello()
```

```
## Error in `say_hello()`:
## ! `name` is absent but must be supplied.
```

]


---
background-image: url(https://rlang.r-lib.org/logo.png)
background-position: 90% 5%
background-size: 8%

# Handle Errors Gracefully II


.pull-left[

The `cli` package provides functions to create consistent and informative messages, warnings, and errors in R.

- Inform the user:


``` r
cli::cli_alert_info("Checking input type with rlang")
```

```
## ‚Ñπ Checking input type with rlang
```

- Success message:


``` r
cli::cli_alert_success("Input type checked!")
```

```
## ‚úî Input type checked!
```



]

.pull-right[

#### Abort if input is not a character: `rlang::is_character(name)`



``` r
# Validate input with rlang
say_hello &lt;- function(name) {
  abort_message &lt;- "Say my name, say my name, `name` must be a character vector."
  
  if (!rlang::is_character(name)) {
  cli::cli_abort(abort_message)
    }
  
  return(paste("Hello", name, "!"))
}

say_hello(1)
```

```
## Error in `say_hello()`:
## ! Say my name, say my name, `name` must be a character vector.
```

]




---
background-image: url(https://rlang.r-lib.org/logo.png)
background-position: 90% 5%
background-size: 8%

# Handle Errors Gracefully III


.pull-left[

- We can limit the input to a specific set of options, like a list of valid names or categories with the arg_match() function

- Sometimes one tiny little letter is enough to make an mistake, but rlang has our back.


``` r
# Restrict input to specific options
say_hello &lt;- function(name = c("Tom", "Jerry")) {
  
  rlang::arg_match(name)
  return(paste("Hello", name, "!"))
}
```



]

.pull-right[


``` r
say_hello(name = "Edgar")
```

```
## Error in `say_hello()`:
## ! `name` must be one of "Tom" or "Jerry", not "Edgar".
```




``` r
# Help users with typos
say_hello(name = "Pom")
```

```
## Error in `say_hello()`:
## ! `name` must be one of "Tom" or "Jerry", not "Pom".
## ‚Ñπ Did you mean "Tom"?
```

]



&lt;br&gt;
Sometimes, you need to handle errors that occur during execution, especially when dealing with external resources like files, databases, or APIs. This is where `tryCatch()` comes in.



---


# tryCatch()

.pull-left[

The function allows us to intercept and respond to errors, warnings, and other conditions without crashing the users interface. The tryCatch() function has several components:

- `expr`: the code that is supposed to run
- `error`: what to do if an error happens
- `warning`: what to do if a warning happens
- `finally`: code that always runs, no matter what



]

.pull-right[



``` r
result &lt;- tryCatch({
  warning("Something might be wrong")
  x &lt;- 10 / "a"
  x
}, warning = function(w) {
  message("Warning: ", w$message)
  0
}, error = function(e) {
  message("Error: ", e$message)
  NA
})
```

```
## Warning: Something might be wrong
```

``` r
print(result)
```

```
## [1] 0
```






]










---
# tryCatch II


.pull-left[




Here‚Äôs a breakdown of how it works in last example:

- Warning handler: If a warning occurs during readRDS(), it will be caught and displayed using cli::cli_warn(). The warning is then muffled to prevent further output.

- Error handler: If an error occurs, a custom error message is shown with cli::cli_alert_danger(), and NULL is returned as a fallback.
- Finally: This code runs no matter what‚Äîwhether there‚Äôs an error, a warning, or success. It‚Äôs useful for logging, cleanup, or confirming that the operation finished.





]

.pull-right[


``` r
# Attempt to read a file that may not exist
result &lt;- tryCatch(
  {
    readRDS("not_a_real_file.rds")
  },
  warning = function(w) {
    cli::cli_warn("A warning occurred: {conditionMessage(w)}")
    invokeRestart("muffleWarning")  # suppress further warning output
  },
  error = function(e) {
    cli::cli_alert_danger("An error occurred: {conditionMessage(e)}")
    NULL  # return fallback value
  },
  finally = {
    cli::cli_alert_info("Finished attempting risky operation.")
  }
)
```

```
## ‚úñ An error occurred: no 'restart' 'muffleWarning' found
```

```
## ‚Ñπ Finished attempting risky operation.
```


]


---
# try()


.pull-left[

- Use `try()` if you don‚Äôt need detailed error handling logic but still want graceful failure: 

- It catches errors and continues running. The function runs the given expression, but if an error happens, it catches that error as an object instead of stopping the function.

- Using the `silent` option keeps the default error message from showing, so you can handle the problem silently.

- As a second step, the code checks if an error occurred with `inherits(result, "try-error")`. Inherits checks if the result is of class try-error, which indicates that an error was caught. In case of an error, we can handle it gracefully.



]

.pull-right[


``` r
# Please don't stop ... on error
result &lt;- try(readRDS("file.rds"), 
              silent = TRUE)

# Check if it worked
if (inherits(result, "try-error")) {
  cli::cli_abort(
    "The file could not be found."
    )
}else {
  cli::cli_alert_success(
    "File read successfully!"
    )
  # Continue processing with result
}
```

```
## Error:
## ! The file could not be found.
```


]





---
background-image: url("images/gonzo.gif")
background-size: cover
class: bottom, center

# .white[Develop with style üëª] 




---
background-image: url(https://styler.r-lib.org/reference/figures/logo.png)
background-position: 90% 5%
background-size: 8%

## 01: Develop With Style(r)


.pull-left[

&lt;div class="info-box"&gt;
  &lt;i&gt;ü¶úÔ∏èÔ∏è&lt;/i&gt; "styler formats your code according to the tidyverse style guide (https://style.tidyverse.org) (or your custom style guide) so you can direct your attention to the content of your code" (M√ºller and Walthert 2024).
&lt;/div&gt;


]

.pull-right[


``` r
styler::style_text(
  "myFunction&lt;-function( x,y){
  if(sum( x , y )==10){
    print( 'Sum is correct!' )
  }
}"
)
```

```
## myFunction &lt;- function(x, y) {
##   if (sum(x, y) == 10) {
##     print("Sum is correct!")
##   }
## }
```

]


There a goodies if you develop an R package:


``` r
styler::style_pkg()
```







---
background-image: url(https://github.com/r-lib/lintr/blob/main/man/figures/logo.png?raw=true)
background-position: 90% 5%
background-size: 8%


## 01: Lintr



.pull-left[

&lt;div class="info-box"&gt;
  &lt;i&gt;ü¶úÔ∏è&lt;/i&gt;"lintr provides static code analysis for R. It checks for adherence to a given style, identifying syntax errors and possible semantic issues, then reports them to you so you can take action" (Hester et al. 2024).
&lt;/div&gt;


]

.pull-right[


``` r
lintr::lint(text = 'myFunction &lt;- function(x, y) {
  if (sum(x, y) == 10) {
    print("Sum is correct!")
  }
}')
```

```
## &lt;text&gt;:1:1: style: [object_name_linter] Variable and function name style should match snake_case or symbols.
## myFunction &lt;- function(x, y) {
## ^~~~~~~~~~
```

]



There are even more goodies ü¶π‚Äç‚ôÄÔ∏è if you develop an R package:


``` r
#lintr::lint_dir(path = "R")
lintr::lint_package()
```












---
class: center, middle

.left-column[

## Keep in touch

#### &lt;a href="https://edgar-treischl.de" target="_blank"&gt;&lt;img src="https://avatars.githubusercontent.com/u/77931249?s=400&amp;u=eaf1d0871b643dd32cc0ff9f777edef28e6569a8&amp;v=4" alt="www.edgar-treischl.de" width="25%"/&gt;&lt;br/&gt;www.edgar-treischl.de&lt;/a&gt;
&lt;br/&gt;

#### &lt;a href="https://github.com/edgar-treischl/Workshop_reproducibleR" target="_blank"&gt;&lt;img src="https://github.githubassets.com/assets/GitHub-Mark-ea2971cee799.png" alt="https://github.com/edgar-treischl" width="30%"/&gt;&lt;br/&gt;edgar-treischl&lt;/a&gt;


]

.right-column[


## Thank you for your attention!
&lt;br/&gt;

&lt;img src="https://i.gifer.com/D71m.gif" style="width: 40%"/&gt;

]







---

## References (1/2)


&lt;p&gt;&lt;cite&gt;Hester, J.
(2023).
&lt;em&gt;covr: Test Coverage for Packages&lt;/em&gt;.
URL: &lt;a href="https://CRAN.R-project.org/package=covr"&gt;https://CRAN.R-project.org/package=covr&lt;/a&gt;.&lt;/cite&gt;&lt;/p&gt;
&lt;p&gt;&lt;cite&gt;Hester, J., F. Angly, R. Hyde, et al.
(2024).
&lt;em&gt;lintr: A 'Linter' for R Code&lt;/em&gt;.
URL: &lt;a href="https://CRAN.R-project.org/package=lintr"&gt;https://CRAN.R-project.org/package=lintr&lt;/a&gt;.&lt;/cite&gt;&lt;/p&gt;
&lt;p&gt;&lt;cite&gt;M√ºller, K.
(2020).
&lt;em&gt;here: A Simpler Way to Find Your Files&lt;/em&gt;.
R package version 1.0.1.
URL: &lt;a href="https://CRAN.R-project.org/package=here"&gt;https://CRAN.R-project.org/package=here&lt;/a&gt;.&lt;/cite&gt;&lt;/p&gt;
&lt;p&gt;&lt;cite&gt;M√ºller, K. and L. Walthert
(2024).
&lt;em&gt;styler: Non-Invasive Pretty Printing of R Code&lt;/em&gt;.
URL: &lt;a href="https://CRAN.R-project.org/package=styler"&gt;https://CRAN.R-project.org/package=styler&lt;/a&gt;.&lt;/cite&gt;&lt;/p&gt;
&lt;p&gt;&lt;cite&gt;Ushey, K. and H. Wickham
(2024).
&lt;em&gt;renv: Project Environments&lt;/em&gt;.
URL: &lt;a href="https://CRAN.R-project.org/package=renv"&gt;https://CRAN.R-project.org/package=renv&lt;/a&gt;.&lt;/cite&gt;&lt;/p&gt;
&lt;p&gt;&lt;cite&gt;Wickham, H.
(2023).
&lt;em&gt;R Packages: Organize, Test, Document, and Share Your Code&lt;/em&gt;.
Sebastopol, CA: O'Reilly.
URL: &lt;a href="https://r-pkgs.org"&gt;https://r-pkgs.org&lt;/a&gt;.&lt;/cite&gt;&lt;/p&gt;
&lt;p&gt;&lt;cite&gt;Wickham, H.
(2011).
&amp;ldquo;testthat: Get Started with Testing&amp;rdquo;.
In: &lt;em&gt;The R Journal&lt;/em&gt; 3, pp. 5&amp;ndash;10.
URL: &lt;a href="https://journal.r-project.org/archive/2011-1/RJournal_2011-1_Wickham.pdf"&gt;https://journal.r-project.org/archive/2011-1/RJournal_2011-1_Wickham.pdf&lt;/a&gt;.&lt;/cite&gt;&lt;/p&gt;
&lt;p&gt;&lt;cite&gt;Wickham, H., J. Bryan, and M. Barrett
(2024).
&lt;em&gt;usethis: Automate Package and Project Setup&lt;/em&gt;.
URL: &lt;a href="https://CRAN.R-project.org/package=usethis"&gt;https://CRAN.R-project.org/package=usethis&lt;/a&gt;.&lt;/cite&gt;&lt;/p&gt;




---

## References (2/2)


&lt;p&gt;&lt;cite&gt;Wickham, H., W. Chang, R. Flight, et al.
(2021).
&lt;em&gt;sessioninfo: R Session Information&lt;/em&gt;.
R package version 1.2.2.
URL: &lt;a href="https://CRAN.R-project.org/package=sessioninfo"&gt;https://CRAN.R-project.org/package=sessioninfo&lt;/a&gt;.&lt;/cite&gt;&lt;/p&gt;
&lt;p&gt;&lt;cite&gt;Wickham, H., P. Danenberg, G. Cs√°rdi, et al.
(2024).
&lt;em&gt;roxygen2: In-Line Documentation for R&lt;/em&gt;.
URL: &lt;a href="https://CRAN.R-project.org/package=roxygen2"&gt;https://CRAN.R-project.org/package=roxygen2&lt;/a&gt;.&lt;/cite&gt;&lt;/p&gt;
&lt;p&gt;&lt;cite&gt;Wickham, H., J. Hesselberth, M. Salmon, et al.
(2024).
&lt;em&gt;pkgdown: Make Static HTML Documentation for a Package&lt;/em&gt;.
URL: &lt;a href="https://CRAN.R-project.org/package=pkgdown"&gt;https://CRAN.R-project.org/package=pkgdown&lt;/a&gt;.&lt;/cite&gt;&lt;/p&gt;
&lt;p&gt;&lt;cite&gt;Wickham, H., J. Hester, W. Chang, et al.
(2022).
&lt;em&gt;devtools: Tools to Make Developing R Packages Easier&lt;/em&gt;.
R package version 2.4.5.
URL: &lt;a href="https://CRAN.R-project.org/package=devtools"&gt;https://CRAN.R-project.org/package=devtools&lt;/a&gt;.&lt;/cite&gt;&lt;/p&gt;
&lt;p&gt;&lt;cite&gt;Xie, Y.
(2024).
&lt;em&gt;knitr: A General-Purpose Package for Dynamic Report Generation in R&lt;/em&gt;.
URL: &lt;a href="https://CRAN.R-project.org/package=knitr"&gt;https://CRAN.R-project.org/package=knitr&lt;/a&gt;.&lt;/cite&gt;&lt;/p&gt;














    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
  "ratio": "16:9",
  "highlightStyle": "github",
  "highlightLines": true,
  "countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
